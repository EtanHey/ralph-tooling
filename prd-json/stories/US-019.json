{
  "id": "US-019",
  "title": "Smart 1Password organization with project/service nesting",
  "description": "⚠️ REQUIRES OPUS MODEL - sensitive secrets handling. Enhance ralph-secrets migrate to organize secrets by project and service. Item names become '{project}/{service}/{KEY}' creating clean op:// paths. Auto-detect service from env var prefix (ANTHROPIC_* → anthropic, SUPABASE_* → supabase, etc). Truly global vars (EDITOR, GIT_*) go to _global/. CRITICAL: Never delete original .env files - only create .env.template alongside.",
  "model": "opus",
  "acceptanceCriteria": [
    { "text": "Define SERVICE_PREFIXES map: ANTHROPIC→anthropic, OPENAI→openai, SUPABASE→supabase, VERCEL→vercel, AWS→aws, STRIPE→stripe, DATABASE/DB→db, REDIS→redis, GITHUB→github, LINEAR→linear, FIGMA→figma", "checked": true },
    { "text": "Define GLOBAL_VARS list: EDITOR, GIT_AUTHOR_NAME, GIT_AUTHOR_EMAIL, PATH-related", "checked": true },
    { "text": "Add _ralph_detect_service() function: parses KEY, returns service name or 'misc'", "checked": true },
    { "text": "Add _ralph_normalize_key() function: strips prefix from key (ANTHROPIC_API_KEY → API_KEY)", "checked": true },
    { "text": "Item title format: {project}/{service}/{normalized_key} (e.g., ralphtools/anthropic/API_KEY)", "checked": true },
    { "text": "Global vars use: _global/{service}/{key} (e.g., _global/git/AUTHOR_NAME)", "checked": true },
    { "text": "op:// reference: op://{vault}/{project}/{service}/{key}/password", "checked": true },
    { "text": "Dry-run shows detected categorization for each var", "checked": true },
    { "text": "Support --service <name> flag to override auto-detection", "checked": true },
    { "text": "NEVER delete or modify original .env file - only create .env.template", "checked": true },
    { "text": "Typecheck passes (zsh -n ralph.zsh)", "checked": true }
  ],
  "passes": true,
  "blockedBy": null
}
