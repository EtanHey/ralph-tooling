{
  "id": "US-109",
  "title": "Self-healing config: test, propose, save",
  "description": "Instead of just detecting at setup, TEST the config on every startup and self-heal if broken.\n\nPattern:\n1. Load config\n2. Test each setting (is bun available? is gum available?)\n3. If test fails → propose fix, ask user\n4. Save preference so we don't ask again\n\nExample flow:\n- Config says runtime=bun\n- Test: command -v bun → NOT FOUND\n- Propose: 'bun not found. Switch to bash? [Y/n]'\n- User confirms → update config.json\n- Next run: uses bash, no prompt\n\nAlso detect:\n- Monorepo from package.json workspaces\n- Tech stack from dependencies\n- Existing RALPH_* vars in .zshrc",
  "type": "feature",
  "priority": "medium",
  "storyPoints": 3,
  "status": "pending",
  "acceptanceCriteria": [
    {
      "text": "=== CONFIG VALIDATION ON STARTUP ===",
      "checked": true
    },
    {
      "text": "Create _ralph_validate_config() function",
      "checked": true
    },
    {
      "text": "Test runtime setting: if bun, check command -v bun",
      "checked": true
    },
    {
      "text": "Test gum availability for bash UI enhancements",
      "checked": true
    },
    {
      "text": "Run validation on every ralph startup (fast, <100ms)",
      "checked": true
    },
    {
      "text": "=== SELF-HEALING PROPOSALS ===",
      "checked": true
    },
    {
      "text": "If runtime=bun but bun missing: propose switch to bash",
      "checked": true
    },
    {
      "text": "If gum missing: note 'install gum for better UI'",
      "checked": true
    },
    {
      "text": "Show Y/n prompt, default to safe option",
      "checked": true
    },
    {
      "text": "Update config.json with user's choice",
      "checked": true
    },
    {
      "text": "Don't ask again once saved (persist preference)",
      "checked": true
    },
    {
      "text": "=== ENVIRONMENT DETECTION ===",
      "checked": true
    },
    {
      "text": "Detect monorepo from package.json workspaces",
      "checked": true
    },
    {
      "text": "Detect tech stack from dependencies",
      "checked": true
    },
    {
      "text": "Check for RALPH_* vars in .zshrc to migrate",
      "checked": true
    },
    {
      "text": "=== TIPS ===",
      "checked": true
    },
    {
      "text": "After any change: 'Run ralph-config to change settings'",
      "checked": true
    },
    {
      "text": "If auto-fixed: 'Config updated. Run ralph-config --reset to reconfigure'",
      "checked": true
    },
    {
      "text": "=== TESTING ===",
      "checked": true
    },
    {
      "text": "Test: Validation catches missing bun",
      "checked": true
    },
    {
      "text": "Test: Proposal updates config correctly",
      "checked": true
    },
    {
      "text": "Test: Saved preference persists across runs",
      "checked": true
    },
    {
      "text": "Commit: feat: US-109 self-healing config validation",
      "checked": true
    },
    {
      "text": "Run CodeRabbit review - must pass (or create BUG if unfixable)",
      "checked": true
    }
  ],
  "dependencies": [
    "MP-003"
  ],
  "passes": true,
  "completedAt": "2026-01-25T02:28:00Z",
  "completedBy": "opus"
}
