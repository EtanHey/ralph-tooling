{
  "id": "US-109",
  "title": "Self-healing config: test, propose, save",
  "description": "Instead of just detecting at setup, TEST the config on every startup and self-heal if broken.\n\nPattern:\n1. Load config\n2. Test each setting (is bun available? is gum available?)\n3. If test fails → propose fix, ask user\n4. Save preference so we don't ask again\n\nExample flow:\n- Config says runtime=bun\n- Test: command -v bun → NOT FOUND\n- Propose: 'bun not found. Switch to bash? [Y/n]'\n- User confirms → update config.json\n- Next run: uses bash, no prompt\n\nAlso detect:\n- Monorepo from package.json workspaces\n- Tech stack from dependencies\n- Existing RALPH_* vars in .zshrc",
  "type": "feature",
  "priority": "medium",
  "storyPoints": 3,
  "status": "pending",
  "acceptanceCriteria": [
    {"text": "=== CONFIG VALIDATION ON STARTUP ===", "checked": false},
    {"text": "Create _ralph_validate_config() function", "checked": false},
    {"text": "Test runtime setting: if bun, check command -v bun", "checked": false},
    {"text": "Test gum availability for bash UI enhancements", "checked": false},
    {"text": "Run validation on every ralph startup (fast, <100ms)", "checked": false},
    {"text": "=== SELF-HEALING PROPOSALS ===", "checked": false},
    {"text": "If runtime=bun but bun missing: propose switch to bash", "checked": false},
    {"text": "If gum missing: note 'install gum for better UI'", "checked": false},
    {"text": "Show Y/n prompt, default to safe option", "checked": false},
    {"text": "Update config.json with user's choice", "checked": false},
    {"text": "Don't ask again once saved (persist preference)", "checked": false},
    {"text": "=== ENVIRONMENT DETECTION ===", "checked": false},
    {"text": "Detect monorepo from package.json workspaces", "checked": false},
    {"text": "Detect tech stack from dependencies", "checked": false},
    {"text": "Check for RALPH_* vars in .zshrc to migrate", "checked": false},
    {"text": "=== TIPS ===", "checked": false},
    {"text": "After any change: 'Run ralph-config to change settings'", "checked": false},
    {"text": "If auto-fixed: 'Config updated. Run ralph-config --reset to reconfigure'", "checked": false},
    {"text": "=== TESTING ===", "checked": false},
    {"text": "Test: Validation catches missing bun", "checked": false},
    {"text": "Test: Proposal updates config correctly", "checked": false},
    {"text": "Test: Saved preference persists across runs", "checked": false},
    {"text": "Commit: feat: US-109 self-healing config validation", "checked": false}
  ],
  "dependencies": ["MP-003"],
  "passes": false
}
